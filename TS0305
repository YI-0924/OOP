//Name:呂欣怡
//Date:March 5,2022
//Last Update:March 8,2022
//Problem statement:This C++ program do simple drawing.

//should out of range,should x

#include<iostream>
#include<string>
#include<iomanip>
#include<cmath>

using namespace std;

void draw(char board[][100], int m, int n);
int main() {
	int m, n;
	cin >> m >> n;
	char board[100][100];
	for (int i = 0; i < n; i++) {
		for (int j = 0; j < m; j++) {
			board[i][j] = '*';
		}
	}
	int w, x, y, x2, y2;
	char fig;
	string dir;
	while (cin >> fig) {
		if (fig == 'S') {
			cin >> w >> x >> y;
			if (w == 1) {
				board[y][x] = 'X';
			}
			else if (w > m || w > n || (x + w) > m || (y + w) > n || x > m - 1 || y > n - 1) {
				cout << "Out of range.\n" << "\n";
				continue;
			}
			else {
				for (int i = 0; i < w; i++) {
					for (int j = 0; j < w; j++) {
						board[i + y][j + x] = 'X';
					}
				}
			}
			draw(board, m, n);
		}
		else if (fig == 'T') {
			cin >> w >> x >> y >> dir;
			if (w == 1) {
				board[y][x] = 'X';
			}
			else if (w > m || w > n || x > m - 1 || y > n - 1 ) {
				cout << "Out of range.\n" << "\n";
				continue;
			}
			else {
				if (dir == "RU") {
					if (x + w + 1 > m || y - w + 1 < 0) {
						cout << "Out of range.\n" << "\n";
						continue;
					}
					for (int i = x; i < x + w; i++) {
						for (int j = y; j > y - w + i - x; j--) {
							board[j][i] = 'X';
						}
					}
				}
				else if (dir == "RD") {
					if (x + w + 1 > m || y + w + 1 > n) {
						cout << "Out of range.\n" << "\n";
						continue;
					}
					for (int i = 0; i < w; i++) {
						for (int j = 0; j < w; j++) {
							if ((y + i + x + j) < x + y + w) {
								board[y + i][x + j] = 'X';
							}
						}
					}
				}
				else if (dir == "LD") {
					if (x - w + 1 < 0 || y + w + 1 > n) {
						cout << "Out of range.\n" << "\n";
						continue;
					}
					for (int i = x; i > x - w; i--) {
						for (int j = y; j < y + w + i - x; j++) {
							board[j][i] = 'X';
						}
					}
				}
				else {
					if (x - w + 1 < 0 || y - w + 1 < 0) {
						cout << "Out of range.\n" << "\n";
						continue;
					}
					for (int i = 0; i < w; i++) {
						for (int j = 0; j < w; j++) {
							if ((y - i + x - j) > x + y - w) {
								board[y - i][x - j] = 'X';
							}
						}
					}
				}
			}
			draw(board, m, n);
		}
		else if (fig == 'L') {
			cin >> x >> y >> x2 >> y2;
			if (x == x2 && y == y2) {
				board[y][x] = 'X';
			}
			else if (x > m - 1 || y > n - 1 || x2 > m - 1 || y2 > n - 1) {
				cout << "Out of range.\n" << "\n";
				continue;
			}
			else {
				if (x == x2) {	//鉛直線
					if (y2 > y) {
						int ytmp = y2;
						y2 = y;
						y = ytmp;
					}
					for (int i = y2; i <= y; i++) {
						board[i][x] = 'X';
					}
				}
				else if (y == y2) {	//水平線
					if (x2 > x) {
						int xtmp = x2;
						x2 = x;
						x = xtmp;
					}
					for (int i = x2; i <= x; i++) {
						board[y][i] = 'X';
					}
				}
				else {
					if (x > x2 && y > y2) {
						int count = 0;
						for (int i = x2; i <= x; i++) {
							board[y2 + count][i] = 'X';
							count++;
						}
					}
					else if(x > x2 && y2 > y) {
						int count = 0;
						for (int i = x2; i <= x; i++) {
							board[y2 - count][i] = 'X';
							count++;
						}
					}
					else if (x2 > x && y > y2) {
						int count = 0;
						for (int i = x; i <= x2; i++) {
							board[y - count][i] = 'X';
							count++;
						}
					}
					else {	// x2 > x && y2 > y
						int count = 0;
						for (int i = x; i <= x2; i++) {
							board[y + count][i] = 'X';
							count++;
						}
					}
				}
			}
			draw(board, m, n);
		}
		else {
			break;
		}
	}
	return 0;
}

void draw(char board[][100], int m, int n) {
	for (int i = 0; i < n; i++) {
		for (int j = 0; j < m; j++) {
			cout << board[i][j];
		}
		cout << "\n";
	}
	cout << "\n";
}
