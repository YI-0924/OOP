//Name:呂欣怡
//Date:March 5,2022
//Last Update:March ,2022
//Problem statement:This C++ program do simple drawing.

#include<iostream>
#include<string>
#include<iomanip>

using namespace std;

void draw(char board[][100], int m, int n);
int main() {
	int m, n;
	cin >> m >> n;
	char board[100][100];
	for (int i = 0; i < n; i++) {
		for (int j = 0; j < m; j++) {
			board[i][j] = '*';
		}
	}
	int w, x, y, x2, y2;
	char fig;
	string dir;
	while (cin >> fig) {
		if (fig == 'S') {
			cin >> w >> x >> y;
			if (w == 1) {
				board[y][x] = 'X';
			}
			else if (w > m || w > n || x > m || y > n || (x + w) > m || (x - w) > m || (y + w) > n || (y - w) > n) {
				cout << "Out of range.\n" << "\n";
				continue;
			}
			else {
				for (int i = 0; i < w; i++) {
					for (int j = 0; j < w; j++) {
						board[i + y][j + x] = 'X';
					}
				}
			}
			draw(board, m, n);
		}
		else if (fig == 'T') {
			cin >> w >> x >> y >> dir;
			if (w == 1) {
				board[y][x] = 'X';
			}
			else if (w > m || w > n || x > m || y > n) {
				cout << "Out of range.\n" << "\n";
				continue;
			}
			else {
				if (dir == "RU") {
					if (x + w + 1 > m || y - w + 1 < 0) {
						cout << "Out of range.\n" << "\n";
						continue;
					}
					for (int i = 0; i < w; i++) {
						for (int j = 0; j < w; j++) {
							if ((x + j) <= (y - i)) {
								board[y - i][x + j] = 'X';
							}
						}
					}
				}
				else if (dir == "RD") {
					if (x + w + 1 > m || y + w + 1 > n) {
						cout << "Out of range.\n" << "\n";
						continue;
					}
					for (int i = 0; i < w; i++) {
						for (int j = 0; j < w; j++) {
							if ((y + i + x + j) < x + y + w) {
								board[y + i][x + j] = 'X';
							}
						}
					}
				}
				else if (dir == "LD") {
					if (x - w + 1 < 0 || y + w + 1 > n) {
						cout << "Out of range.\n" << "\n";
						continue;
					}
					for (int i = 0; i < w; i++) {
						for (int j = 0; j < w; j++) {
							if ((y + i) >= (x - j)) {
								board[y + i][x - j] = 'X';
							}
						}
					}
				}
				else {
					if (x - w + 1 < 0 || y - w + 1 < 0) {
						cout << "Out of range.\n" << "\n";
						continue;
					}
					for (int i = 0; i < w; i++) {
						for (int j = 0; j < w; j++) {
							if ((y - i + x - j) > x + y - w) {
								board[y - i][x - j] = 'X';
							}
						}
					}
				}
			}
			draw(board, m, n);
		}
		else if (fig == 'L') {
			cin >> x >> y >> x2 >> y2;
			if (x == x2 && y == y2) {
				board[y][x] = 'X';
			}
			else if (x > m || y > n || x2 > m || y2 > n ) {
				cout << "Out of range.\n" << "\n";
				continue;
			}
			else {
				for (int i = 0; i <= fabs(y - y2); i++) {
					for (int j = 0; j <= fabs(x - x2); j++) {
						if (y == y2 || x == x2) {
							board[i + y][j + x] = 'X';
						}
						if ((i + y) == (j + x)) {
							board[i + y][j + x] = 'X';
						}
					}
				}
			}
			draw(board, m, n);
		}
		else {
			break;
		}
	}
	return 0;
}

void draw(char board[][100], int m, int n) {
	for (int i = 0; i < n; i++) {
		for (int j = 0; j < m; j++) {
			cout << board[i][j];
		}
		cout << "\n";
	}
	cout << "\n";
}
